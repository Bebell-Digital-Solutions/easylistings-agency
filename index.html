<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Easy Listings</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@500&display=swap" rel="stylesheet">
<!-- Favicon -->
<link rel="icon" href="https://bucket.mlcdn.com/a/3336/3336910/images/fa62e06dd2b6ed2d1d9e77e5dd944bef2904d5d1.png">
<style>
:root {
    --primary: #DF1783;
    --primary-light: #f8a4d4;
    --secondary: #2d3748;
    --accent: #4fd1c5;
    --text: #2d3748;
    --text-light: #a0aec0;
    --bg: #f7fafc;
    --card-bg: #ffffff;
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --border-color: #e2e8f0;
}

.dark-mode {
    --text: #f7fafc; --text-light: #a0aec0; --bg: #1a202c;
    --card-bg: #2d3748; --shadow: 0 4px 6px -1px rgba(0,0,0,0.4), 0 2px 4px -1px rgba(0,0,0,0.2);
    --border-color: #4a5568;
}

html { box-sizing: border-box; overflow-x: hidden; scroll-behavior: smooth; }
*, *:before, *:after { box-sizing: inherit; margin: 0; padding: 0; }

body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--bg);
    color: var(--text);
    transition: background-color 0.3s, color 0.3s;
    overflow-x: hidden;
}

.top-menu-bar {
    position: fixed; top: 2rem; left: 50%; transform: translateX(-50%);
    width: calc(100% - 4rem); max-width: 1400px; z-index: 1100;
    background-color: var(--card-bg); box-shadow: var(--shadow);
    border: 1px solid var(--border-color); border-radius: 12px;
    padding: 0 1.5rem; transition: top 0.3s ease-in-out;
}
.top-menu-bar.hidden { top: -100px; }
.top-menu-content { height: 70px; display: flex; align-items: center; justify-content: space-between; }
.logo-container { display: flex; align-items: center; gap: 1rem; }
#appLogo { height: 40px; width: 40px; object-fit: cover; border-radius: 8px; }
#appBrandNameDisplay { font-size: 1.5rem; font-weight: 600; color: var(--text); }
.top-menu-actions { display: flex; align-items: center; gap: 1rem; }
.fab {
    width: 40px; height: 40px; border-radius: 50%; background-color: var(--bg);
    color: var(--text); border: 1px solid var(--border-color); display: flex;
    justify-content: center; align-items: center; cursor: pointer; transition: all 0.2s ease;
}
.fab:hover { background-color: var(--border-color); }

.header-banner {
    width: 100%; padding: 170px 2rem 4rem 2rem; text-align: center;
    position: relative; background-size: cover; background-position: center;
    color: white; overflow: hidden;
}
.header-banner::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    background-color: rgba(0,0,0,0.5); z-index: 1;
}
.header-content { position: relative; z-index: 2; max-width: 1400px; margin: 0 auto; }
.admin-greeting {
    background-color: var(--primary); color: white; padding: 8px 20px;
    border-radius: 25px; font-size: 1.5rem; font-weight: 500;
    display: inline-block; margin-bottom: 1.5rem; font-family: 'Caveat', cursive;
    transition: transform 0.2s ease, filter 0.2s ease;
}
.admin-greeting:hover { transform: translateY(-2px); filter: brightness(1.1); }
.header-banner h1 { font-size: 2.8rem; color: white; margin-bottom: 1rem; min-height: 50px; }
#brand-anim-span::after { content: '|'; animation: blink 1s infinite; }
@keyframes blink { 50% { opacity: 0; } }
.header-banner p { font-size: 1.2rem; color: rgba(255,255,255,0.9); margin-bottom: 2rem; }
.header-banner .controls-container { background-color: var(--card-bg); box-shadow: var(--shadow); margin-bottom: 0; }

.container { max-width: 1400px; margin: 0 auto; padding: 2rem 4rem; }
.controls-container {
    display: flex; flex-wrap: wrap; justify-content: center; align-items: center;
    gap: 1.5rem; padding: 2.3rem; border-radius: 12px;
    max-width: 800px; width: 100%; margin-left: auto; margin-right: auto;
}
.search-bar { position: relative; flex-grow: 1; max-width: 700px; }
.search-bar input { width: 100%; padding: 12px 20px 12px 45px; border-radius: 30px; border: 1px solid var(--border-color); background-color: var(--bg); color: var(--text); font-size: 1rem; }
.search-bar i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--text-light); }
.btn { background-color: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none; text-align: center; }
.btn.btn-danger { background-color: #e53e3e; }
.btn.btn-secondary { background-color: var(--secondary); }
.btn:hover { opacity: 0.85; transform: translateY(-2px); }

.tag-filters { display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; margin-bottom: 2.5rem; }
.tag-filter-btn { background-color: var(--card-bg); color: var(--text); border: 1px solid var(--border-color); padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: 500; transition: all 0.3s ease; }
.tag-filter-btn:hover { background-color: var(--border-color); transform: translateY(-2px); }
.tag-filter-btn.active { background-color: var(--primary); color: white; border-color: var(--primary); }

.listing-section { margin-bottom: 3rem; }
.section-header { text-align: center; margin-bottom: 2rem; }
.section-header h2 { font-size: 2rem; color: var(--text); margin-bottom: 0.5rem; }
.section-header p { font-size: 1.1rem; color: var(--text-light); max-width: 600px; margin: 0 auto; }

.grid-container {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2.5rem;
}

.card {
    background-color: var(--card-bg); border-radius: 12px;
    overflow: hidden; box-shadow: var(--shadow);
    display: flex; flex-direction: column; position: relative;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}
.card-admin-controls {
    position: absolute; top: 10px; left: 10px; z-index: 3;
    display: none; gap: 8px;
}
body.admin-logged-in .card-admin-controls { display: flex; }
.admin-btn {
    background-color: rgba(0,0,0,0.6); color: white; border: none;
    width: 35px; height: 35px; border-radius: 50%; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.9rem; transition: background-color 0.2s;
}
.admin-btn:hover { background-color: rgba(0,0,0,0.8); }

.card-carousel {
    position: relative; aspect-ratio: 16 / 10;
    background-color: var(--border-color); overflow: hidden;
}
.carousel-track { display: flex; height: 100%; transition: transform 0.5s ease-in-out; }
.carousel-slide { min-width: 100%; height: 100%; }
.carousel-slide img { width: 100%; height: 100%; object-fit: cover; }
.carousel-badge {
    position: absolute; top: 1rem; right: 1rem; z-index: 2;
    background-color: var(--primary); color: white;
    padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;
}
.card-body { padding: 1.5rem; flex-grow: 1; display: flex; flex-direction: column; }
.card-title { font-size: 1.4rem; font-weight: 700; color: var(--text); margin-bottom: 0.25rem; }
.card-subtitle { font-size: 1rem; color: var(--primary); margin-bottom: 1rem; font-weight: 500; }
.card-description { font-size: 0.9rem; color: var(--text-light); line-height: 1.6; margin-bottom: 1.5rem; }
.card-details-title { font-weight: 600; margin-bottom: 0.75rem; color: var(--text); }
.card-details-list { list-style: none; padding-left: 0; margin-bottom: 1.5rem; }
.card-details-list li { margin-bottom: 0.5rem; color: var(--text-light); }
.card-price { font-size: 1.5rem; font-weight: 700; color: var(--accent); margin-bottom: 1.5rem; }
.card-price .negotiable { font-size: 0.9rem; font-weight: 400; color: var(--text-light); }
.card-tags { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1.5rem; }
.card-tag { background-color: var(--primary-light); color: var(--primary); padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 500; }
.card-ctas { margin-top: auto; display: flex; gap: 1rem; }
.card-ctas .btn { flex: 1; border-radius: 8px; }

#getInTouchBlock {
    display: none;
    text-align: center;
    padding: 3rem 1rem;
    margin: 4rem auto;
    background-color: var(--card-bg);
    border-radius: 12px;
    box-shadow: var(--shadow);
    max-width: 800px;
}
.get-in-touch-profile-pic {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background-size: cover;
    background-position: center;
    margin: 0 auto 1rem auto;
    border: 4px solid var(--primary);
    position: relative;
}
.waving-hand {
    position: absolute;
    top: -10px;
    right: -10px;
    font-size: 2.5rem;
    animation: wave-animation 2.5s infinite;
    transform-origin: 70% 70%;
}
@keyframes wave-animation {
    0% { transform: rotate(0.0deg) }
    10% { transform: rotate(14.0deg) }
    20% { transform: rotate(-8.0deg) }
    30% { transform: rotate(14.0deg) }
    40% { transform: rotate(-4.0deg) }
    50% { transform: rotate(10.0deg) }
    60% { transform: rotate(0.0deg) }
    100% { transform: rotate(0.0deg) }
}
#getInTouchBlock h3 {
    font-size: 1.8rem;
    color: var(--text);
    margin-bottom: 1.5rem;
}

#mapContainer { width: 100%; max-width: 1400px; margin: 4rem auto 0 auto; height: 450px; background-color: var(--border-color); border-radius: 12px; }
#mapContainer iframe { width: 100%; height: 100%; border:0; border-radius: 12px; }

.footer { padding: 2rem 1rem; text-align: center; color: var(--text-light); border-top: 1px solid var(--border-color); margin-top: 4rem; }
.bebell-footer { padding: 20px; font-size: 12px; }
.bebell-footer p { margin: 0; line-height: 1.6; }
.bebell-link { color: var(--text-light); text-decoration: none; }
.bebell-link:hover { color: var(--primary); text-decoration: underline; }

/* Modal Styles */
.modal {
    position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; 
    background-color: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center;
}
.modal.active { display: flex; }
.modal-content { 
    background-color: var(--card-bg); padding: 2rem; border-radius: 12px; 
    width: 90%; max-width: 600px; position: relative; 
    box-shadow: 0 10px 25px rgba(0,0,0,0.2); max-height: 90vh; overflow-y: auto; 
}
.modal-content h3 { margin-bottom: 1.5rem; }
.modal-content h4 { margin-top: 2rem; margin-bottom: 1rem; }
.modal-close { position: absolute; top: 15px; right: 15px; font-size: 1.5rem; color: var(--text-light); cursor: pointer; }
.form-group { margin-bottom: 1rem; }
.form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
.form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--bg); color: var(--text); }
.profile-pic-uploader { display: flex; flex-direction: column; align-items: center; gap: 1rem; margin-bottom: 1rem; }
.profile-pic-preview { width: 120px; height: 120px; border-radius: 50%; border: 3px dashed var(--primary); display: flex; align-items: center; justify-content: center; cursor: pointer; background-size: cover; background-position: center; color: var(--text-light); }
.profile-pic-preview i { font-size: 2rem; }
.profile-pic-uploader input[type="file"] { display: none; }
.recommendations { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem; }
.recommendation-btn { background: var(--bg); border: 1px solid var(--border-color); padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; }
.share-url-container { display: flex; gap: 0.5rem; }
.image-input-group { margin-top: 0.5rem; }
.toggle-container { display: flex; align-items: center; gap: 10px; margin-top: 1rem; font-size: 0.9rem; }
.toggle-switch { position: relative; display: inline-block; width: 50px; height: 28px; flex-shrink: 0; }
.toggle-switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 28px; }
.slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + .slider { background-color: var(--primary); }
input:checked + .slider:before { transform: translateX(22px); }
hr { border: 0; border-top: 1px solid var(--border-color); margin: 2rem 0; }
.checkbox-group { display: flex; align-items: center; gap: 10px; margin-bottom: 1rem; }
.checkbox-group input[type="checkbox"] { width: auto; }

.notification-banner { 
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
    background-color: var(--accent); color: white; 
    padding: 1.5rem 2.5rem; border-radius: 12px; 
    box-shadow: var(--shadow); z-index: 3000; font-weight: 500; 
    opacity: 0; visibility: hidden; transition: all 0.3s ease-in-out; 
}
.notification-banner.show { opacity: 1; visibility: visible; }

#backToTopBtn {
    display: none; position: fixed; bottom: 20px; right: 30px; z-index: 99;
    border: none; outline: none; background-color: var(--primary); color: white;
    cursor: pointer; padding: 0; width: 50px; height: 50px; border-radius: 50%;
    font-size: 18px; box-shadow: var(--shadow);
}
#backToTopBtn:hover { opacity: 0.8; }

/* Responsive Grid Layout */
@media (max-width: 1024px) {
    .grid-container {
        grid-template-columns: repeat(2, 1fr); /* 2 columns for tablets */
    }
}

@media (max-width: 768px) {
    .container { padding: 1rem; }
    .header-banner .controls-container .btn {
        width: 100%;
    }
    .logo-container { max-width: 150px; }
    #appBrandNameDisplay { font-size: 16px; }
    #supportBtn { display: none; }

    .tag-filters {
        flex-wrap: nowrap;
        justify-content: flex-start;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 1rem;
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    .tag-filters::-webkit-scrollbar { display: none; }
    .tag-filter-btn { flex-shrink: 0; }

    .grid-container {
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        gap: 1.5rem;
        padding-bottom: 1rem;
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    .grid-container::-webkit-scrollbar { display: none; }
    .card {
        flex: 0 0 80%;
        width: 80%;
        scroll-snap-align: start;
    }
}
</style>
</head>
<body>

<div id="notification" class="notification-banner"></div>

<div class="top-menu-bar">
    <div class="top-menu-content">
        <div class="logo-container">
            <img id="appLogo" src="https://bucket.mlcdn.com/a/3336/3336910/images/fa62e06dd2b6ed2d1d9e77e5dd944bef2904d5d1.png" alt="App Logo">
            <span id="appBrandNameDisplay">Easy Listings</span>
        </div>
        <div class="top-menu-actions">
            <div class="fab" id="settingsBtn" title="Settings"><i class="fas fa-cog"></i></div>
            <div class="fab" id="supportBtn" title="Support" onclick="window.open('https://helpcenter.easylistings.website', '_blank')"><i class="fa fa-info-circle"></i></div>
            <div class="fab" id="darkModeToggle" title="Toggle Theme"><i class="fas fa-moon"></i></div>
        </div>
    </div>
</div>

<header class="header-banner" id="mainHeader">
    <div class="header-content">
        <div id="adminGreeting" class="admin-greeting">Hey there! ðŸ‘‹</div>
        <h1 id="main-header-title">Welcome to <span id="brand-anim-span"></span></h1>
        <p id="main-header-subtitle">Your professional hub for managing and showcasing property listings.</p>
        <div class="controls-container">
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Search listings...">
            </div>
            <button class="btn" id="addNewEntryBtn"><i class="fas fa-plus"></i> Add New Listing</button>
        </div>
    </div>
</header>

<main class="container">
    <div class="tag-filters" id="tagFilters"></div>
    <div class="content-wrapper">
        <div id="listingPlaceholder">
            <div id="listingsContainer"></div>
        </div>
    </div>
    <div id="getInTouchBlock">
        <div class="get-in-touch-profile-pic" id="getInTouchPic">
            <div class="waving-hand">ðŸ‘‹</div>
        </div>
        <h3>Let's get in touch!</h3>
        <a href="#" id="getInTouchBtn" class="btn btn-secondary">Contact via WhatsApp</a>
    </div>
    <div id="mapContainer"></div>
</main>

<footer class="footer" id="mainFooter"></footer>
<button id="backToTopBtn" title="Go to top"><i class="fas fa-arrow-up"></i></button>

<!-- MODALS -->
<div id="loginModal" class="modal">
    <div class="modal-content">
        <span class="modal-close">&times;</span>
        <h3>Restricted Access</h3>
        <p id="login-message"></p>
        <form id="loginForm">
            <div class="form-group"><label for="loginEmail">Email Address</label><input type="email" id="loginEmail" required></div>
            <div class="form-group"><label for="loginPassword">Password</label><input type="password" id="loginPassword" required></div>
            <button type="submit" class="btn" style="width: 100%;">Confirm Admin Access</button>
        </form>
        <div id="lifetimeAccessBtnContainer" style="display:none; margin-top: 1rem;"></div>
    </div>
</div>

<div id="setupModal" class="modal">
    <div class="modal-content">
        <span class="modal-close">&times;</span>
        <h3>Let's Get You Started! ðŸŽ‰</h3>
        <p>Your account is approved. Complete your profile to launch your directory.</p>
        <form id="setupForm">
            <input type="hidden" id="setupEmail">
            <div class="profile-pic-uploader"><label for="setupProfilePic" class="profile-pic-preview" id="setupProfilePicPreview"><i class="fas fa-camera"></i></label><input type="file" id="setupProfilePic" accept="image/*"></div>
            <div class="form-group"><label for="setupBrandName">Brand Name</label><input type="text" id="setupBrandName" required></div>
            <div class="form-group"><label for="setupUsername">Username</label><input type="text" id="setupUsername" required></div>
            <div class="form-group"><label for="setupListingsSheetId">Listings Google Sheet ID</label><input type="text" id="setupListingsSheetId" required></div>
            <div class="form-group">
                <label for="setupListingsScriptUrl">Listings Script URL</label>
                <input type="text" id="setupListingsScriptUrl" required>
                <p class="field-instructions" style="margin-top: 10px;">
                    <strong>Need help?</strong> <a href="https://helpcenter.easylistings.website" target="_blank" rel="noopener noreferrer">Follow our guide to get your Sheet ID and Listings Script URL.</a>
                </p>
            </div>
            <button type="submit" class="btn" style="width: 100%;">Launch My Listings</button>
        </form>
    </div>
</div>

<div id="settingsModal" class="modal">
    <div class="modal-content">
        <span class="modal-close" data-modal-id="settingsModal">&times;</span>
        <h3>Settings</h3>
        <div class="settings-profile">
            <div id="settingsProfilePic" class="profile-pic-container"><i class="fas fa-user"></i></div>
            <div>
                <h4>Welcome, <span id="settingsUsernameDisplay">Admin</span>! ðŸŽ‰</h4>
                <p style="font-size: 0.9rem; color: var(--text-light); margin: 0;">You have access to all administrative features.</p>
            </div>
        </div>
        <div class="form-group">
            <label for="shareableUrl">Your Shareable Listings URL</label>
            <div class="share-url-container">
                <input type="text" id="shareableUrl" readonly>
                <button id="copyShareableUrlBtn" class="btn" title="Copy URL"><i class="fas fa-copy"></i></button>
            </div>
        </div>
        <hr>
        <h4>Contact Settings</h4>
        <div class="form-group"><label for="settingsWhatsappNumber">WhatsApp Phone Number</label><input type="tel" id="settingsWhatsappNumber"></div>
        <div class="form-group"><label for="settingsWhatsappMessage">Default WhatsApp Message</label><textarea id="settingsWhatsappMessage" rows="3"></textarea></div>
        <hr>
        <div id="whiteLabelSettings" style="display: none;">
            <h4>White Label Settings</h4>
            <div class="toggle-container">
                <label class="toggle-switch">
                    <input type="checkbox" id="enableLeadForm">
                    <span class="slider"></span>
                </label>
                <span>Enable Lead Capture Form (replaces WhatsApp button)</span>
            </div>
        </div>
        <button id="saveSettingsBtn" class="btn" style="width: 100%;">Save Customizations</button>
    </div>
</div>

<div id="editCardModal" class="modal">
    <div class="modal-content">
        <span class="modal-close">&times;</span>
        <h3 id="editModalTitle">Add New Listing</h3>
        <input type="hidden" id="listingPropertyId">
        <div class="form-group">
            <label for="listingTitle">Title</label>
            <input type="text" id="listingTitle" required>
        </div>
        <div class="form-group">
            <label for="listingSubtitle">Subtitle</label>
            <input type="text" id="listingSubtitle">
        </div>
        <div class="form-group">
            <label for="listingDescription">Description</label>
            <textarea id="listingDescription" rows="4"></textarea>
        </div>
        <div class="form-group">
            <label for="listingPrice">Price (optional)</label>
            <input type="number" id="listingPrice">
        </div>
        <div class="checkbox-group">
            <input type="checkbox" id="listingNegotiable">
            <label for="listingNegotiable">Negotiable</label>
        </div>
        <div class="form-group">
            <label for="listingCategory">Category</label>
            <input type="text" id="listingCategory" placeholder="e.g., Downtown Apartments">
        </div>
        <div class="form-group">
            <label for="listingCategoryDescription">Category Description</label>
            <input type="text" id="listingCategoryDescription" placeholder="A brief description for this group of listings.">
        </div>
        <div class="form-group">
            <label for="listingTags">Tags</label>
            <input type="text" id="listingTags">
            <div class="recommendations" id="tagRecommendations"></div>
        </div>
        <hr>
        <h4>Secondary CTA Button (Optional)</h4>
        <div class="form-group">
            <label for="secondaryCtaText">Button Text</label>
            <input type="text" id="secondaryCtaText">
        </div>
        <div class="form-group">
            <label for="secondaryCtaLink">Button Link</label>
            <input type="text" id="secondaryCtaLink">
        </div>
        <button type="submit" id="saveListingBtn" class="btn" style="width:100%">Save Listing</button>
    </div>
</div>

<div id="leadCaptureModal" class="modal">
    <div class="modal-content">
        <span class="modal-close">&times;</span>
        <h3>Inquire About This Property</h3>
        <form id="leadCaptureForm">
            <input type="hidden" id="leadPropertyId">
            <div class="form-group">
                <label for="leadName">Full Name</label>
                <input type="text" id="leadName" required>
            </div>
            <div class="form-group">
                <label for="leadEmail">Email</label>
                <input type="email" id="leadEmail" required>
            </div>
            <div class="form-group">
                <label for="leadPhone">Phone Number</label>
                <input type="tel" id="leadPhone">
            </div>
            <div class="form-group">
                <label for="leadMessage">Message</label>
                <textarea id="leadMessage" rows="4"></textarea>
            </div>
            <button type="submit" class="btn" style="width:100%">Submit Inquiry</button>
        </form>
    </div>
</div>

<div id="confirmationModal" class="modal">
    <div class="modal-content" style="max-width: 400px;">
        <h3 id="confirmationTitle">Are you sure?</h3>
        <p id="confirmationMessage">This action cannot be undone.</p>
        <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem;">
            <button id="confirmCancelBtn" class="btn" style="background-color: var(--secondary);">Cancel</button>
            <button id="confirmDeleteBtn" class="btn btn-danger">Delete</button>
        </div>
    </div>
</div>

<canvas id="confetti-canvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999;"></canvas>

<script src="https://unpkg.com/lucide@latest"></script>
<script type="module">
    import confetti from 'https://cdn.skypack.dev/canvas-confetti';
    window.triggerConfetti = function() {
        const canvas = document.getElementById('confetti-canvas');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        confetti({ particleCount: 400, spread: 400, origin: { x: 0.5, y: 0.5 }, colors: ['#DF1783', '#f8a4d4', '#4fd1c5', '#2d3748', '#ffffff'] });
    };
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- CONFIGURATION ---
    const ADMIN_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwFHCC9E0etIqCxmbBfWfXBAN6V5w_3oguWA-HaseHHGeaSiPQQ2KtDEIR-LmnuktF60A/exec';
    const LIFETIME_DEAL_URL = 'https://your-lifetime-deal-url.com';

    // --- STATE ---
    let appConfig = {};
    let isLoggedIn = false;
    let currentTypingTimeout;
    let allListings = [];
    let carouselIntervals = {};

    // --- DOM ELEMENTS ---
    const topMenuBar = document.querySelector('.top-menu-bar');
    const mainHeader = document.getElementById('mainHeader');
    const brandAnimSpan = document.getElementById('brand-anim-span');
    const appBrandNameDisplay = document.getElementById('appBrandNameDisplay');
    const mapContainer = document.getElementById('mapContainer');
    const mainFooter = document.getElementById('mainFooter');
    const loginModal = document.getElementById('loginModal');
    const setupModal = document.getElementById('setupModal');
    const settingsModal = document.getElementById('settingsModal');
    const loginMessage = document.getElementById('login-message');
    const listingsContainer = document.getElementById('listingsContainer');
    const notificationBanner = document.getElementById('notification');
    const tagFiltersContainer = document.getElementById('tagFilters');
    const searchInput = document.getElementById('searchInput');
    const backToTopBtn = document.getElementById('backToTopBtn');
    const getInTouchBlock = document.getElementById('getInTouchBlock');

    // --- INITIALIZATION ---
    function initializeApp() {
        lucide.createIcons();
        setupEventListeners();
        applyTheme();
        
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('user')) {
            loadPublicView(urlParams.get('user'));
        } else {
            loadHomePage();
        }
    }

    function applyTheme() {
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            document.getElementById('darkModeToggle').querySelector('i').className = 'fas fa-sun';
        } else {
            document.body.classList.remove('dark-mode');
            document.getElementById('darkModeToggle').querySelector('i').className = 'fas fa-moon';
        }
    }

    function loadHomePage() {
        applyCustomization({ brandname: 'Easy Listings' });
        renderMapByIP();
        allListings = [
            { propertyId: 'P123', title: 'Modern Downtown Loft', subtitle: 'Financial District', description: 'A stunning loft with breathtaking city views, perfect for urban living.', price: 450000, negotiable: true, tags: ['2 Bedrooms', '2 Baths', 'Furnished'], images: ['https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?auto=format&fit=crop&w=800&q=60', 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&w=800&q=60'], status: 'For Sale', category: 'Downtown Apartments', categoryDescription: 'Live in the heart of the city.' },
            { propertyId: 'P124', title: 'Chic Studio with Balcony', subtitle: 'Arts District', description: 'A stylish and compact studio apartment with a private balcony, perfect for a young professional.', price: 320000, negotiable: false, tags: ['1 Bedroom', '1 Bath', 'Furnished'], images: ['https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?auto=format&fit=crop&w=800&q=60'], status: 'For Sale', category: 'Downtown Apartments', categoryDescription: 'Live in the heart of the city.' },
            { propertyId: 'P125', title: 'Penthouse with Rooftop Terrace', subtitle: 'City Center', description: 'Top-floor penthouse offering panoramic cityscapes from a private rooftop terrace. Includes premium amenities and modern finishes.', price: 890000, negotiable: true, tags: ['3 Bedrooms', '3 Baths', 'Furnished', 'Garage'], images: ['https://images.unsplash.com/photo-1605146769289-440113cc3d00?auto=format&fit=crop&w=800&q=60'], status: 'For Sale', category: 'Downtown Apartments', categoryDescription: 'Live in the heart of the city.' },
            { propertyId: 'P456', title: 'Cozy Suburban Home', subtitle: 'Maple Creek Estates', description: 'Charming 3-bedroom home with a spacious backyard, ideal for families.', price: 280000, negotiable: false, tags: ['3 Bedrooms', '2 Baths', 'Garage'], images: ['https://images.unsplash.com/photo-1580587771525-78b9dba3b914?auto=format&fit=crop&w=800&q=60'], status: 'Sold', category: 'Family Homes', categoryDescription: 'Perfect homes for growing families.' },
            { propertyId: 'P457', title: 'Spacious Colonial with Pool', subtitle: 'Oakwood Neighborhood', description: 'Beautiful 4-bedroom colonial style home featuring a large in-ground pool and a beautifully landscaped yard.', price: 550000, negotiable: true, tags: ['4 Bedrooms', '3 Baths', 'Garage'], images: ['https://images.unsplash.com/photo-1572120360610-d971b9d7767c?auto=format&fit=crop&w=800&q=60'], status: 'For Sale', category: 'Family Homes', categoryDescription: 'Perfect homes for growing families.' },
            { propertyId: 'P458', title: 'Modern Farmhouse on 5 Acres', subtitle: 'Green Valley', description: 'A newly built modern farmhouse with ample space for a family, surrounded by nature and tranquility.', price: 720000, negotiable: false, tags: ['4 Bedrooms', '3 Baths', 'Garage'], images: ['https://images.unsplash.com/photo-1588880331179-bc9b93a8cb5e?auto=format&fit=crop&w=800&q=60'], status: 'For Sale', category: 'Family Homes', categoryDescription: 'Perfect homes for growing families.' },
            { propertyId: 'P789', title: 'Luxury Beachfront Villa', subtitle: 'Sunset Shores', description: 'An exquisite villa with direct beach access and panoramic ocean views.', price: 1250000, negotiable: true, tags: ['5 Bedrooms', '4 Baths', 'Furnished'], images: ['https://images.unsplash.com/photo-1570129477492-45c003edd2be?auto=format&fit=crop&w=800&q=60'], status: 'For Rent', category: 'Luxury Villas', categoryDescription: 'Experience the pinnacle of coastal living.' },
            { propertyId: 'P790', title: 'Secluded Mountain Retreat', subtitle: 'Aspen Highlands', description: 'Escape to this breathtaking mountain retreat with stunning views, a private hot tub, and ski-in/ski-out access.', price: 2100000, negotiable: false, tags: ['5 Bedrooms', '5 Baths', 'Furnished', 'Garage'], images: ['https://images.unsplash.com/photo-1582268611958-ebfd161ef9cf?auto=format&fit=crop&w=800&q=60'], status: 'For Rent', category: 'Luxury Villas', categoryDescription: 'Experience the pinnacle of coastal living.' },
            { propertyId: 'P791', title: 'Contemporary Architectural Gem', subtitle: 'Hillside Estates', description: 'A masterpiece of modern architecture with an infinity pool, home theater, and unparalleled privacy.', price: 3500000, negotiable: true, tags: ['5 Bedrooms', '6 Baths', 'Furnished', 'Garage'], images: ['https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=800&q=60'], status: 'For Rent', category: 'Luxury Villas', categoryDescription: 'Experience the pinnacle of coastal living.' }
        ];
        filterAndRenderListings();
        renderTagFilters(allListings);
        searchInput.disabled = false;
    }

    function loadPublicView(userId) {
        // In a real app, you would fetch user data and listings here.
        // For now, we'll use mock data and show the contact block.
        const mockPublicUserData = {
            brandname: 'John Doe Realty',
            profilePicUrl: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?auto=format&fit=crop&w=200&q=80',
            whatsappNumber: '15551234567'
        };
        applyCustomization(mockPublicUserData);
        renderGetInTouchBlock(mockPublicUserData);
        loadHomePage(); // Also load the listings
    }
    
    // --- UI & CUSTOMIZATION ---
    function applyCustomization(config) {
        appConfig = config;
        const brandName = config.brandname || 'Easy Listings';
        appBrandNameDisplay.textContent = brandName;
        const animationTexts = [`${brandName}`, "Our Listings Page"];
        typeWriterAnimation(animationTexts);
        mainHeader.style.backgroundImage = `url(${config.bannerimageurl || 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?auto=format&fit=crop&w=1200&q=80'})`;
        renderFooter(config);
    }
    
    function typeWriterAnimation(words) {
        clearTimeout(currentTypingTimeout);
        brandAnimSpan.textContent = '';
        let wordIndex = 0, charIndex = 0, isDeleting = false;
        function type() {
            const currentWord = words[wordIndex];
            brandAnimSpan.textContent = isDeleting ? currentWord.substring(0, charIndex--) : currentWord.substring(0, charIndex++);
            let typeSpeed = isDeleting ? 100 : 150;
            if (!isDeleting && charIndex === currentWord.length + 1) { typeSpeed = 2000; isDeleting = true; } 
            else if (isDeleting && charIndex === 0) { isDeleting = false; wordIndex = (wordIndex + 1) % words.length; typeSpeed = 500; }
            currentTypingTimeout = setTimeout(type, typeSpeed);
        }
        type();
    }

    function renderFooter(config) {
        let footerHTML = (config.status === 'White Label' && config.brandname)
            ? `<p>Copyright Â© 2024 â€¢ ${config.brandname}<br>All rights reserved.</p>`
            : `<div class="bebell-footer"><p>Powered with ðŸ’– by <a href="https://bebelldigitalsolutions.com" class="bebell-link" target="_blank">Bebell Digital Solutions.</a><br>Copyright Â© 2024 â€¢ All rights reserved.</p></div>`;
        mainFooter.innerHTML = footerHTML;
    }

    async function renderMapByIP() {
        if (appConfig.googleMapsUrl) {
            mapContainer.innerHTML = `<iframe src="${appConfig.googleMapsUrl}" allowfullscreen="" loading="lazy"></iframe>`;
            return;
        }
        try {
            const response = await fetch('https://ipapi.co/json/');
            const data = await response.json();
            const { latitude, longitude } = data;
            const mapUrl = `https://maps.google.com/maps?q=${latitude},${longitude}&z=12&output=embed`;
            mapContainer.innerHTML = `<iframe src="${mapUrl}" allowfullscreen="" loading="lazy"></iframe>`;
        } catch (error) {
            mapContainer.innerHTML = '<p style="text-align:center; padding: 2rem;">Could not determine location to display map.</p>';
        }
    }

    function renderGetInTouchBlock(config) {
        getInTouchBlock.style.display = 'block';
        document.getElementById('getInTouchPic').style.backgroundImage = `url(${config.profilePicUrl || 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?auto=format&fit=crop&w=200&q=80'})`;
        const whatsappUrl = `https://wa.me/${config.whatsappNumber || ''}`;
        document.getElementById('getInTouchBtn').href = whatsappUrl;
    }
    
    function filterAndRenderListings() {
        const searchTerm = searchInput.value.toLowerCase();
        const activeTagBtn = tagFiltersContainer.querySelector('.active');
        const selectedTag = activeTagBtn ? activeTagBtn.dataset.tag : 'all';

        const filtered = allListings.filter(listing => {
            const tagMatch = selectedTag === 'all' || (listing.tags && listing.tags.includes(selectedTag));
            const searchMatch = !searchTerm || 
                listing.title.toLowerCase().includes(searchTerm) ||
                listing.subtitle.toLowerCase().includes(searchTerm) ||
                listing.description.toLowerCase().includes(searchTerm) ||
                (listing.tags && listing.tags.some(t => t.toLowerCase().includes(searchTerm)));
            return tagMatch && searchMatch;
        });
        renderListings(filtered);
    }
    
    function renderListings(listings) {
        listingsContainer.innerHTML = '';
        
        // Clear all existing carousel intervals
        Object.values(carouselIntervals).forEach(interval => clearInterval(interval));
        carouselIntervals = {};
        
        const groupedByCategory = listings.reduce((acc, listing) => {
            const category = (listing.category || '').trim() || 'Other Listings';
            if (!acc[category]) {
                acc[category] = {
                    description: listing.categoryDescription || '',
                    items: []
                };
            }
            acc[category].items.push(listing);
            return acc;
        }, {});

        for (const categoryName in groupedByCategory) {
            const section = document.createElement('section');
            section.className = 'listing-section';

            const header = document.createElement('header');
            header.className = 'section-header';
            header.innerHTML = `
                <h2>${categoryName}</h2>
                <p>${groupedByCategory[categoryName].description}</p>
            `;
            section.appendChild(header);

            const grid = document.createElement('div');
            grid.className = 'grid-container';
            groupedByCategory[categoryName].items.forEach(listing => {
                grid.appendChild(createListingCard(listing));
            });
            section.appendChild(grid);
            listingsContainer.appendChild(section);
        }
        initializeCarousels();
    }

    function renderTagFilters(listings) {
        const allTags = listings.flatMap(l => l.tags || []);
        const uniqueTags = [...new Set(allTags)];
        tagFiltersContainer.innerHTML = `<button class="tag-filter-btn active" data-tag="all">All</button>` +
            uniqueTags.map(tag => `<button class="tag-filter-btn" data-tag="${tag}">${tag}</button>`).join('');
    }

    function createListingCard(listing) {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.propertyId = listing.propertyId;

        const priceHTML = listing.price ? `
            <div class="card-price">
                $${new Intl.NumberFormat().format(listing.price)}
                ${listing.negotiable ? '<span class="negotiable">(Negotiable)</span>' : ''}
            </div>` : '';
        
        const tagsHTML = (listing.tags || []).map(tag => `<span class="card-tag">${tag}</span>`).join('');

        let primaryCtaHTML = '';
        if (appConfig.enableLeadForm && appConfig.status === 'White Label') {
            primaryCtaHTML = `<button class="btn btn-primary lead-btn">Inquire Now</button>`;
        } else if (appConfig.whatsappNumber) {
            const message = (appConfig.whatsappMessage || "Hello, I'm interested in the property with ID: [PropertyID].").replace('[PropertyID]', listing.propertyId);
            const whatsappUrl = `https://wa.me/${appConfig.whatsappNumber}?text=${encodeURIComponent(message)}`;
            primaryCtaHTML = `<a href="${whatsappUrl}" target="_blank" class="btn btn-secondary">Contact via WhatsApp</a>`;
        }

        card.innerHTML = `
            <div class="card-admin-controls">
                <button class="admin-btn edit-btn" title="Edit"><i class="fas fa-pencil-alt"></i></button>
                <button class="admin-btn delete-btn" title="Delete"><i class="fas fa-trash"></i></button>
            </div>
            <div class="card-carousel">
                <div class="carousel-track">
                    ${listing.images.map(img => `<div class="carousel-slide"><img src="${img}" alt="${listing.title}" onerror="this.src='https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?auto=format&fit=crop&w=800&q=60'"></div>`).join('')}
                </div>
                <div class="carousel-badge">${listing.status}</div>
            </div>
            <div class="card-body">
                <h3 class="card-title">${listing.title}</h3>
                <p class="card-subtitle">${listing.subtitle}</p>
                <p class="card-description">${listing.description}</p>
                ${priceHTML}
                <div class="card-tags">${tagsHTML}</div>
                <div class="card-ctas">
                    ${primaryCtaHTML}
                </div>
            </div>
        `;
        return card;
    }
    
    function initializeCarousels() {
        document.querySelectorAll('.card-carousel').forEach((carousel, index) => {
            const track = carousel.querySelector('.carousel-track');
            const slides = Array.from(track.children);
            if (slides.length <= 1) return;

            let currentIndex = 0;
            
            // Clear any existing interval for this carousel
            if (carouselIntervals[index]) {
                clearInterval(carouselIntervals[index]);
            }
            
            carouselIntervals[index] = setInterval(() => {
                currentIndex = (currentIndex + 1) % slides.length;
                track.style.transform = `translateX(-${currentIndex * 100}%)`;
            }, 3000);

            carousel.addEventListener('mouseenter', () => {
                clearInterval(carouselIntervals[index]);
            });
            
            carousel.addEventListener('mouseleave', () => {
                carouselIntervals[index] = setInterval(() => {
                    currentIndex = (currentIndex + 1) % slides.length;
                    track.style.transform = `translateX(-${currentIndex * 100}%)`;
                }, 3000);
            });
        });
    }

    // --- AUTH & ONBOARDING ---
    async function handleLogin(e) {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        showNotification('Authenticating...', 'info');

        try {
            // MOCK LOGIC
            let result;
            const mockUser = localStorage.getItem(email);
            if (!mockUser) {
                result = { status: 'new_user_pending', message: 'Your access request has been submitted.' };
                localStorage.setItem(email, JSON.stringify({ password, status: 'Waiting for Approval' }));
            } else {
                const userData = JSON.parse(mockUser);
                if (userData.password !== password) {
                    result = { status: 'invalid_credentials', message: 'Invalid email or password.' };
                } else {
                    switch(userData.status) {
                        case 'Waiting for Approval': result = { status: 'pending_approval', message: 'Your account is still pending approval.' }; break;
                        case 'Published': result = { status: 'setup_required', message: 'Login successful! Please complete your profile.', userData }; break;
                        case 'Active': result = { status: 'login_success', message: 'Welcome back!', userData }; break;
                        case 'Blocked': result = { status: 'blocked', message: `Your account is blocked. <a href="${LIFETIME_DEAL_URL}" target="_blank">Purchase a license</a> to continue.` }; break;
                    }
                }
            }
            // END MOCK
            
            if(loginMessage) loginMessage.innerHTML = result.message;
            if (result.status === 'login_success') grantAdminAccess(result.userData);
            else if (result.status === 'setup_required') {
                closeModal(loginModal);
                document.getElementById('setupEmail').value = email;
                openModal(setupModal);
                if(window.triggerConfetti) window.triggerConfetti();
            }
        } catch (error) {
            if(loginMessage) loginMessage.textContent = 'âš ï¸ Connection error.';
        } finally {
            hideNotification();
        }
    }

    function grantAdminAccess(userData) {
        isLoggedIn = true;
        document.body.classList.add('admin-logged-in');
        closeModal(loginModal);
        showNotification('Login Successful!', 'success');
        if(window.triggerConfetti) window.triggerConfetti();
        applyCustomization(userData);
        if (userData.status === 'White Label') {
            document.getElementById('whiteLabelSettings').style.display = 'block';
        }
        filterAndRenderListings(); // Re-render to show admin controls
    }
    
    // --- MODALS & EVENT LISTENERS ---
    function openModal(modal) { if(modal) modal.classList.add('active'); }
    function closeModal(modal) { if(modal) modal.classList.remove('active'); }

    function setupEventListeners() {
        document.getElementById('settingsBtn').addEventListener('click', () => isLoggedIn ? openModal(settingsModal) : openModal(loginModal));
        document.getElementById('addNewEntryBtn').addEventListener('click', () => isLoggedIn ? openModal(document.getElementById('editCardModal')) : openModal(loginModal));
        document.getElementById('darkModeToggle').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
            applyTheme();
        });
        document.querySelectorAll('.modal-close').forEach(btn => btn.addEventListener('click', () => closeModal(btn.closest('.modal'))));
        document.getElementById('loginForm').addEventListener('submit', handleLogin);

        tagFiltersContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('tag-filter-btn')) {
                tagFiltersContainer.querySelector('.active').classList.remove('active');
                e.target.classList.add('active');
                filterAndRenderListings();
            }
        });

        searchInput.addEventListener('input', filterAndRenderListings);

        let lastScrollTop = 0;
        window.addEventListener('scroll', function() {
            let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            topMenuBar.classList.toggle('hidden', scrollTop > lastScrollTop && scrollTop > 100);
            backToTopBtn.style.display = scrollTop > 300 ? 'block' : 'none';
            lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
        }, false);
        backToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
    }

    // --- NOTIFICATIONS ---
    let notificationTimeout;
    function showNotification(message, type = 'info') {
        if (!notificationBanner) return;
        notificationBanner.textContent = message;
        notificationBanner.style.backgroundColor = type === 'error' ? '#e53e3e' : 'var(--accent)';
        notificationBanner.classList.add('show');
        clearTimeout(notificationTimeout);
        notificationTimeout = setTimeout(() => notificationBanner.classList.remove('show'), 3000);
    }
    function hideNotification() { 
        if(notificationBanner) notificationBanner.classList.remove('show'); 
    }

    initializeApp();
});
</script>
</body>
</html>



